<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>প্রজ্ঞা</title>
  <link rel="stylesheet" href="libraries/swiperjs/swiper.css" />
  <link rel="stylesheet" href="main.css">
  
  
  
  <style type="text/css" media="all">
    .frnds {
      
      height: calc(100vh - 80px);
      
      
      display: grid;
      grid-template-rows: 60px auto;
      
    }
    
    
    .search {}
    
    .users {}
  </style>
</head>

<body>
  
  
  
  
  
  <div class="header x4">
    <div class="img-container">
      <div class="inner-img-container">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="scale:1.5;"><!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
          <path d="M14.29 6.29 8.59 12l5.7 5.71 1.42-1.42-4.3-4.29 4.3-4.29z" />
        </svg>
        
      </div>
    </div>
    
    
    <div class="title-container">
      <p>কমিউনিটি</p>
    </div>
    <div class="img-container">
      <div class="inner-img-container" id="addNotes">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
          <path d="M20 2H4c-.55 0-1 .45-1 1v2c0 .22.07.43.2.6L9 13.33V21a1 1 0 0 0 1 1c.15 0 .31-.04.45-.11l4-2A1 1 0 0 0 15 19v-5.67l5.8-7.73c.13-.17.2-.38.2-.6V3c0-.55-.45-1-1-1m-1 2.67-5.8 7.73c-.13.17-.2.38-.2.6v5.38l-2 1V13c0-.22-.07-.43-.2-.6L5 4.67V4h14z" />
        </svg>
      </div>
    </div>
    <div class="img-container">
      <div class="inner-img-container">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><!--Boxicons v3.0 https://boxicons.com | License  https://docs.boxicons.com/free-->
          <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z" />
        </svg>
      </div>
    </div>
    
  </div>
  
  <div style="height:80px;"></div>
  
  
  <div class="frnds">
    
    
    <div class="search" id="search">
      
      <p id="searchP">jj</p>
      
      
    </div>
    
    <div class="users" id="users"></div>
    
    
    
    
    
    
  </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <script src="libraries/swiperjs/swiper.js"></script>
  
  <script src="main.js" type="module"></script>
  <script src="libraries/supabase/supabase.js" type="module"></script>
  <script src="backend.js" type="module"></script>
  <script charset="utf-8" type="module">
    import "./backend.js";
    
    
    let searchP = document.getElementById("searchP")
    let usersBox = document.getElementById("users");
    
    
    searchP.addEventListener('click', (e) => {
      searchP.contentEditable = "true";
      searchP.focus();
    });
    
    searchP.addEventListener('focusout', async (e) => {
      
      searchP.contentEditable = "false";
      
    });
    
    
    
    searchP.addEventListener('input', async (e) => {
      //  console.log("Current text:", searchP.innerText, sb);
      
      
      
      let txt = searchP.innerText.trim();
      
      
      if (txt.length === 0) {
        usersBox.innerHTML = "";
        return;
      }
      
      // search in supabase
      ({ data, error } = await sb
        .from("userInfo")
        .select("*")
        .ilike("name", `%${txt}%`));
      
      if (error) {
        console.log("Supabase Error:", error);
        return;
      }
      
      // clear old UI
      usersBox.innerHTML = "";
      
     
       
      // fill UI with matches
      data.forEach(user => {
        
        if (user.user_id != id) {
          let p = document.createElement("p");
          p.innerText = `${user.name} — ${user.profile}`;
          
          
          p.addEventListener('click', async (e) => {
            
            ({ data, error } = await sb
              .from('socialInfo')
              .select('frndReqsSent')
              .eq('user_id', id));
            
            let frndReqsSent = data[0].frndReqsSent || [];
            


            if (!frndReqsSent.includes(user.user_id)) {
              frndReqsSent.push(user.user_id);
            }
            
            
            
            ({ data, error } = await sb
              .from('socialInfo')
              .update({ frndReqsSent: frndReqsSent })
              .eq('user_id', id));
            
            
            
            
            
               ({ data, error } = await sb
              .from('socialInfo')
              .select('frndReqsReceived')
              .eq('user_id', user.user_id));
            
            console.log(data,error);
            let frndReqsReceived = data[0].frndReqsReceived || [];
            console.log(frndReqsReceived);


            if (!frndReqsReceived.includes(id)) {
              frndReqsReceived.push(id);
            }
            console.log(frndReqsReceived);
            
            
            ({ data, error } = await sb
              .from('socialInfo')
              .update({ frndReqsReceived: frndReqsReceived })
              .eq('user_id', user.user_id));
            
            
            console.log(data,error);
            
            
            
            
            
            
            
            
            
          });
          
          
          
          
          usersBox.appendChild(p);
        }
      });
      
      
      
      
    });
  </script>
</body>

</html>