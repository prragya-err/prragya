<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>My AI Chatbot</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: #f1f1f1;
    }
    
    #chat {
      height: 80vh;
      overflow-y: auto;
      padding: 10px;
      background: white;
    }
    
    .msg {
      padding: 8px 12px;
      margin: 8px 0;
      border-radius: 10px;
      max-width: 80%;
      line-height: 1.4;
      white-space: pre-wrap;
    }
    
    .user {
      background: #d1e7ff;
      margin-left: auto;
    }
    
    .bot {
      background: #eee;
      margin-right: auto;
    }
    
    #box {
      display: flex;
      padding: 10px;
      background: #fff;
      gap: 10px;
    }
    
    input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: black;
      color: white;
      cursor: pointer;
    }
  </style>
</head>

<body>
  
  <div id="chat"></div>
  
  <div id="box">
    <input id="inp" placeholder="Ask something...">
    <button onclick="sendMsg()">Send</button>
  </div>
  
  <script>
    async function sendMsg() {
      const text = document.getElementById("inp").value.trim();
      
      
      const files = [
        "/md_data/Bi_1_1_1_to_10.pdf.md",
        "/md_data/Bi_1_1_11_to_20.pdf.md",
        "/md_data/Bi_1_1_21_to_30.pdf.md",
        "/md_data/Bi_1_1_31_to_40.pdf.md",
        "/md_data/Bi_1_1_41_to_50.pdf.md"
      ];
      
      let allContent = "You are Prragya Ai.You are given this text as resource.Read it and hive to the point answer of users question.Also use your brain to answer questions that are not present here.Dont return response in markdown but in html format.This is the txt :"; // This will store all markdown text
      
      // Loop through all files and append content
      for (let file of files) {
        const res = await fetch(file);
        const text = await res.text();
        allContent += text + "\n\n"; // append with spacing
      }
      
      allContent += "now try to ans the question or user prompt:";
      if (!text) return;
      
      // Show user message
      addMsg(text, "user");
      document.getElementById("inp").value = "";
      
      // Create empty bot bubble to stream into
      const botBubble = addMsg("", "bot");
      
      // STREAMING FETCH
      const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: {
          Authorization: `Bearer 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`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'openai/gpt-oss-20b:free',
          messages: [{ role: 'user', content: text }],
          stream: true,
        }),
      });
      
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let buffer = '';
      
      try {
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          
          buffer += decoder.decode(value, { stream: true });
          
          while (true) {
            const lineEnd = buffer.indexOf('\n');
            if (lineEnd === -1) break;
            
            const line = buffer.slice(0, lineEnd).trim();
            buffer = buffer.slice(lineEnd + 1);
            
            if (line.startsWith('data: ')) {
              const data = line.slice(6);
              if (data === '[DONE]') break;
              
              try {
                const parsed = JSON.parse(data);
                const content = parsed.choices[0].delta.content;
                
                if (content) {
                  botBubble.innerHTML += content;
                  chat.scrollTop = chat.scrollHeight;
                }
              } catch (e) {}
            }
          }
        }
      } finally {
        reader.cancel();
      }
    }
    
    // Utility to add messages
    function addMsg(text, type) {
      const chat = document.getElementById("chat");
      const div = document.createElement("div");
      div.className = "msg " + type;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      return div;
    }
  </script>
  
</body>

</html>